package secp256k1

import (
	"math/big"
	"testing"
)

func TestIsOnCurve(t *testing.T) {
	testCases := []struct {
		name string
		x    string
		y    string
		ok   bool
	}{
		{
			"base point",
			gx,
			gy,
			true,
		},
		{
			"not on curve",
			"1",
			"1",
			false,
		},
	}

	s256 := S256()
	x, y := new(big.Int), new(big.Int)

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			x.SetString(tc.x, 16)
			y.SetString(tc.y, 16)

			if ok := s256.IsOnCurve(x, y); ok != tc.ok {
				t.Errorf("expected: %t, actual: %t", tc.ok, ok)
			}
		})
	}
}

func TestAdd(t *testing.T) {
	testCases := []struct {
		name   string
		x1, y1 string
		x2, y2 string
		x3, y3 string
	}{
		{
			"(x1, y1) is point at infinity",
			"0", "0",
			gx, gy,
			gx, gy,
		},
		{
			"(x2, y2) is point at infinity",
			gx, gy,
			"0", "0",
			gx, gy,
		},
	}

	s256 := S256()
	x1, y1 := new(big.Int), new(big.Int)
	x2, y2 := new(big.Int), new(big.Int)
	x3Expected, y3Expected := new(big.Int), new(big.Int)

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			x1.SetString(tc.x1, 16)
			y1.SetString(tc.y1, 16)
			x2.SetString(tc.x2, 16)
			y2.SetString(tc.y2, 16)
			x3Expected.SetString(tc.x3, 16)
			y3Expected.SetString(tc.y3, 16)

			x3, y3 := s256.Add(x1, y1, x2, y2)
			if x3.Cmp(x3Expected) != 0 {
				t.Errorf("expected: %x, actual: %x", x3Expected, x3)
			}
			if y3.Cmp(y3Expected) != 0 {
				t.Errorf("expected: %x, actual: %x", y3Expected, y3)
			}
		})
	}
}

func TestDouble(t *testing.T) {
	testCases := []struct {
		name   string
		x1, y1 string
		x3, y3 string
	}{
		{
			"(x1, y1) is point at infinity",
			"0", "0",
			"0", "0",
		},
	}

	s256 := S256()
	x1, y1 := new(big.Int), new(big.Int)
	x3Expected, y3Expected := new(big.Int), new(big.Int)

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			x1.SetString(tc.x1, 16)
			y1.SetString(tc.y1, 16)
			x3Expected.SetString(tc.x3, 16)
			y3Expected.SetString(tc.y3, 16)

			x3, y3 := s256.Double(x1, y1)
			if x3.Cmp(x3Expected) != 0 {
				t.Errorf("expected: %x, actual: %x", x3Expected, x3)
			}
			if y3.Cmp(y3Expected) != 0 {
				t.Errorf("expected: %x, actual: %x", y3Expected, y3)
			}
		})
	}
}

func TestScalarBaseMult(t *testing.T) {
	testCases := []struct {
		name string
		k    string
		x    string
		y    string
	}{
		{
			"k: 1",
			"1",
			"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",
			"483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",
		},
		{
			"k: 2",
			"2",
			"c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5",
			"1ae168fea63dc339a3c58419466ceaeef7f632653266d0e1236431a950cfe52a",
		},
		{
			"k: 3",
			"3",
			"f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9",
			"388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672",
		},
		{
			"k: 4",
			"4",
			"e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd13",
			"51ed993ea0d455b75642e2098ea51448d967ae33bfbdfe40cfe97bdc47739922",
		},
		{
			"k: 5",
			"5",
			"2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4",
			"d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6",
		},
		{
			"k: 6",
			"6",
			"fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556",
			"ae12777aacfbb620f3be96017f45c560de80f0f6518fe4a03c870c36b075f297",
		},
		{
			"k: 7",
			"7",
			"5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc",
			"6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da",
		},
		{
			"k: 8",
			"8",
			"2f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01",
			"5c4da8a741539949293d082a132d13b4c2e213d6ba5b7617b5da2cb76cbde904",
		},
		{
			"k: 9",
			"9",
			"acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe",
			"cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37",
		},
		{
			"k: 10",
			"10",
			"a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7",
			"893aba425419bc27a3b6c7e693a24c696f794c2ed877a1593cbee53b037368d7",
		},
		{
			"k: 11",
			"11",
			"774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb",
			"d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b",
		},
		{
			"k: 12",
			"12",
			"d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a",
			"a9f34ffdc815e0d7a8b64537e17bd81579238c5dd9a86d526b051b13f4062327",
		},
		{
			"k: 13",
			"13",
			"f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8",
			"0ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81",
		},
		{
			"k: 14",
			"14",
			"499fdf9e895e719cfd64e67f07d38e3226aa7b63678949e6e49b241a60e823e4",
			"cac2f6c4b54e855190f044e4a7b3d464464279c27a3f95bcc65f40d403a13f5b",
		},
		{
			"k: 15",
			"15",
			"d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e",
			"581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58",
		},
		{
			"k: 16",
			"16",
			"e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a",
			"f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821",
		},
		{
			"k: 17",
			"17",
			"defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34",
			"4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77",
		},
		{
			"k: 18",
			"18",
			"5601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7cc",
			"c136c1dc0cbeb930e9e298043589351d81d8e0bc736ae2a1f5192e5e8b061d58",
		},
		{
			"k: 19",
			"19",
			"2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c",
			"85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a",
		},
		{
			"k: 20",
			"20",
			"4ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97",
			"12ba26dcb10ec1625da61fa10a844c676162948271d96967450288ee9233dc3a",
		},
		{
			"k: 112233445566778899",
			"112233445566778899",
			"a90cc3d3f3e146daadfc74ca1372207cb4b725ae708cef713a98edd73d99ef29",
			"5a79d6b289610c68bc3b47f3d72f9788a26a06868b4d8e433e1e2ad76fb7dc76",
		},
		{
			"k: 112233445566778899112233445566778899",
			"112233445566778899112233445566778899",
			"e5a2636bcfd412ebf36ec45b19bfb68a1bc5f8632e678132b885f7df99c5e9b3",
			"736c1ce161ae27b405cafd2a7520370153c2c861ac51d6c1d5985d9606b45f39",
		},
		{
			"k: 6950511619965839450988900688150712778015737983940691968051900319680",
			"6950511619965839450988900688150712778015737983940691968051900319680",
			"3deab011abd77dc404154a3cbfcc5a22d759577c2dce56a287f445d8ccdf677f",
			"9801e22f0d2608bbb0604494897f33a0fdbc70b68f28bce819809c6e9af6bc05",
		},
		{
			"k: 13479972933410060327035789020509431695094902435494295338570602119423",
			"13479972933410060327035789020509431695094902435494295338570602119423",
			"ede99da098b7574727618cd8eef784d9ad505e232cf8256b5116b668dfbf145f",
			"82afdc0bc38f4fa42834b6b934d45890172ddb18f101ac037f5533269a2bb263",
		},
		{
			"k: 13479971751745682581351455311314208093898607229429740618390390702079",
			"13479971751745682581351455311314208093898607229429740618390390702079",
			"14dce6348fcf912efbb69361c0e86054e3cf261cb117bf76ae44e6a59d369225",
			"fde9e63458dd92ac86e1b4797ba3061aefbecaccd504f9970d734136617fd4fb",
		},
		{
			"k: 13479972931865328106486971546324465392952975980343228160962702868479",
			"13479972931865328106486971546324465392952975980343228160962702868479",
			"7626904b0e89c4320b3b9867594d196dd7e1052a1943045080f36967890af751",
			"1b37eac496f43485b90e45200db80510c32170edb9d148a8f0fa78cbaa7b920d",
		},
		{
			"k: 11795773708834916026404142434151065506931607341523388140225443265536",
			"11795773708834916026404142434151065506931607341523388140225443265536",
			"59f6bfce87ba8a14749acc1efe4b5479f41deb315f5f42fd1022d1eda648660a",
			"8cd92e0f88834ae14438ae94350496847c2e5eeb8c47a264778b2c746318ee3b",
		},
		{
			"k: 784254593043826236572847595991346435467177662189391577090",
			"784254593043826236572847595991346435467177662189391577090",
			"a32af5b78ae31a8749af411d3d25d73dc0ce89cf788bb608da84228265580510",
			"2a58679f2b22bbd593f92afb62ddd37f53276a670b957edb6d30ab1ea46cd86e",
		},
		{
			"k: 13479767645505654746623887797783387853576174193480695826442858012671",
			"13479767645505654746623887797783387853576174193480695826442858012671",
			"dba4157a978bf3bf8d3b87d17a6846b0a9d6b177864322cbb6c9b5cfe8f16b40",
			"9227c36f4c51db77fe4a30e354208bfc1e8e2bbffcf35bc18e5f0280ab5ed228",
		},
		{
			"k: 205688069665150753842126177372015544874550518966168735589597183",
			"205688069665150753842126177372015544874550518966168735589597183",
			"8b275e2205e5938043139b111a8ce80bc03d6374a1a3b08c38ef8a4f263a8d9f",
			"068109774a48d94f752fa938a64e8ac9009c03dca3ae4d29ad0381cce7711588",
		},
		{
			"k: 13479966930919337728895168462090683249159702977113823384618282123295",
			"13479966930919337728895168462090683249159702977113823384618282123295",
			"c6b9afd243138e4ff38305037e5c9635df145f97692eabb364ef62efad899425",
			"7ba87cbee446f04f3065eb0564c4f3a2d2734b764a1ff64643700f9ef605da4c",
		},
		{
			"k: 50210731791415612487756441341851895584393717453129007497216",
			"50210731791415612487756441341851895584393717453129007497216",
			"5af07a6b165f256271b00755801bf21a7386b0deff2e34ce8a40fc9dee4f563b",
			"0aea24395138efad00fffb850c5cb666938aae7e8d750df314a7628bd5d07ce4",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368041",
			"26959946667150639794667015087019625940457807714424391721682722368041",
			"9b4f928076c30da525bb689d80b363ee373cc286f99f7bde16f3ef2d1b7cd2f7",
			"ab025ac9b9e3cb2e4f92430a9ca8650643c4e9d87cf6ee464ad5f2d61ab3ff85",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368042",
			"26959946667150639794667015087019625940457807714424391721682722368042",
			"e6efa199e391e7a1f1e06dd269da27a04835744aaf8c35d41830ce99ada39b43",
			"0527e88cd6658e0893ffc542c506e22e455cd792bc0c8cca5bec822d189758e1",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368043",
			"26959946667150639794667015087019625940457807714424391721682722368043",
			"e3d5fcae0dfa22ae57d23095ed2674a18dc06b37a2d5d804964ac72adb8ef94c",
			"60ebe8332b7318a5dd09bea3dfdedec63a68142775568565f813f8e8c8595609",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368044",
			"26959946667150639794667015087019625940457807714424391721682722368044",
			"9e2f8de452af14c2ea80421e3ff4cb5c49997be3bf6a6224eeae94421de24dfe",
			"19bcbd6ebb7d1c4db55f7868ab770534e700a586abe3930253804418781bdbcf",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368045",
			"26959946667150639794667015087019625940457807714424391721682722368045",
			"54393b8926339a7fd25a578b9dabdfad53e6bfcc35a382afd2d25efaba515eee",
			"05644e55c94583fae9fc3e2cf35d6edc7ffd0e5f969c202bf3bbcecd2f98e10b",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368046",
			"26959946667150639794667015087019625940457807714424391721682722368046",
			"9abcc85ffabb967a6370af79a63016d7645fdae5e24a39e5e8faaf6281246c59",
			"8ee69392f8e34796ca8e4075fd610926b91044b11adde968a4e482d9f111b011",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368047",
			"26959946667150639794667015087019625940457807714424391721682722368047",
			"4908376410522c92296941f083191ec06b9b6a003fe1bd6a1667106a4a52e071",
			"3dfc10166bd670e09bd310c6039d193eb06b8e30e4f7702e577b1f8f99b4f338",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368048",
			"26959946667150639794667015087019625940457807714424391721682722368048",
			"7486a2025e4d073e7ec4448c02a9d671b9d6e9892c7594dd18a2fd9a742409b4",
			"47fab2fcbde6ed780c5c27fe8d2f236ec3178796861b83aa36c3117f58831a3d",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368049",
			"26959946667150639794667015087019625940457807714424391721682722368049",
			"d5e1d6f35f5b2030ae241f18e70a8034d5a9226bfb2bfed13200b8f7af03793e",
			"67ac7ed6492716f939c23ea626891543b526e86d3e29e3ac60d786822a8934bf",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368050",
			"26959946667150639794667015087019625940457807714424391721682722368050",
			"4d5179639675da02283b525da9b1a1a78ea37225c73314ccf21dd230803d4f01",
			"c623e1009b6e0666cdd1114f6a3a53cf1a68c55a377a971900deb2938fbf98d1",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368051",
			"26959946667150639794667015087019625940457807714424391721682722368051",
			"4972445c30bff76d45a061a5aa691e1c6f89bc4ec0d36eb02579d388452e6176",
			"f2895eaee99724284866aeff69e1bc590bb06e47d36e0efe1b987f31405f6ae4",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368052",
			"26959946667150639794667015087019625940457807714424391721682722368052",
			"b13ab7643938b7340579ed2f988e0f8e59c268287757e8f97e09ce523400cf18",
			"17479e8c8ca511633e5f7500f58a27ab08b3fb4ddcc602a47edc38af09e5d9bc",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368053",
			"26959946667150639794667015087019625940457807714424391721682722368053",
			"86b749a04c3a81a5db23c21d8d49b4d2b1505340338617840f4d1bca8a52cc0a",
			"38ca53dffb80934e52765e58c7dac245262789f4349df66291ffe8e6d5a1cd7a",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368054",
			"26959946667150639794667015087019625940457807714424391721682722368054",
			"16351157fe9f637c4cf6b7ace4bb75afc4acd6928f5194cc05792746f1f48e7c",
			"6858f7297a9a332ca985ae985fae299c4cd428a4f4ae794fee65048a30f1cde1",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368055",
			"26959946667150639794667015087019625940457807714424391721682722368055",
			"569a722cd308f7e477bccb53b44d49b6f82b32c9b14cf6877eae168c3a6d4041",
			"b3049d3eee2e75bf7fc55048de830bd7d39e9377be1cbbbfeb711086935481fd",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368056",
			"26959946667150639794667015087019625940457807714424391721682722368056",
			"f42516fab2b0870ceb99ae0388009ec5fd8370af70fe335ea45d8137008158cf",
			"988c7aed3f1068e30dc4938292330f62b2ade6389b2928a63574c90a847d3889",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368057",
			"26959946667150639794667015087019625940457807714424391721682722368057",
			"fa404f35d0f6ae83d42a84d06789da56d49ba5bf19e80e01730ab516acf5896c",
			"47f375719fbc414e0f90bdf0463bdfbdbdee08e7814594a23f26aa99718f5318",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368058",
			"26959946667150639794667015087019625940457807714424391721682722368058",
			"26d125d954354148cf931318bb78ac6e51db50eb526fdc33af1977f1d07bd4bb",
			"22984a06983dc12ea812c7b5f41cdc3fd40190cdce22a2badde916797377d4d1",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368059",
			"26959946667150639794667015087019625940457807714424391721682722368059",
			"fc91374c548e170fba1dc60bc9f70af01b71b78baa28a3d3c4a75ae11ebe063a",
			"8081ca29b65aa3ea1169ba1d8eec14390cdd5b2001a1ea9679a0e9536174e967",
		},
		{
			"k: 26959946667150639794667015087019625940457807714424391721682722368060",
			"26959946667150639794667015087019625940457807714424391721682722368060",
			"c8ab03a9588097bab4bfbfdb953588ff9aae6e2517484dc2552df5c8fc626da2",
			"bdec2840464e033aa4d9eeaca893b2786f1d1d4d7e02027dc70b2802aac67566",
		},
	}

	s256 := S256()
	k, xExpected, yExpected := new(big.Int), new(big.Int), new(big.Int)

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			k.SetString(tc.k, 10)
			xExpected.SetString(tc.x, 16)
			yExpected.SetString(tc.y, 16)

			x, y := s256.ScalarBaseMult(k.Bytes())
			if x.Cmp(xExpected) != 0 {
				t.Errorf("expected: %x, actual: %x", xExpected, x)
			}
			if y.Cmp(yExpected) != 0 {
				t.Errorf("expected: %x, actual: %x", yExpected, y)
			}
		})
	}
}
